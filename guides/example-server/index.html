<!DOCTYPE html>
<html>
	<head>
		
			<title>Example Server</title>
		
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<link rel="icon" type="image/png" href="../../_static/icon.png"/>
		<link rel="stylesheet" href="../../_static/site.css" type="text/css" media="screen"/>
		
		<script src="../../_components/jquery/jquery.min.js"></script>
		<script src="../../_components/jquery-syntax/jquery.syntax.min.js"></script>
		
		<script src="../../_static/links.js"></script>
		
		<script type="text/javascript">
		//<![CDATA[
			jQuery(function($) {
				$.syntax();
			});
		//]]>
		</script>
	</head>

	<body>
		<header> › <a class="link" href="../../index.html">Project</a> › <a class="link" href="../index.html">Guides</a></header>
		
		<main>
			
	<h1>Example Server</h1>
	
	<p>This example demonstrates now to use <a href="../../source/Localhost/Authority/index.html" title="Localhost::Authority"><code class="language-ruby">class Localhost::Authority</code></a> to implement a simple HTTPS client &amp; server.</p>
<h2><code>https.rb</code></h2><p>Require the required libraries:</p>
<pre><code class="language-ruby">require 'async'
require 'async/io/host_endpoint'
require 'async/io/ssl_endpoint'
require 'async/http/server'
require 'async/http/client'
require 'localhost'</code></pre><p>The (self-signed) authority to use:</p>
<pre><code class="language-ruby">hostname = &quot;localhost&quot;
authority = Localhost::Authority.fetch(hostname)</code></pre><p>The server app:</p>
<pre><code class="language-ruby">app = lambda do |request|
	Protocol::HTTP::Response[200, {}, [&quot;Hello World&quot;]]
end</code></pre><p>Bind to the specified host:</p>
<pre><code class="language-ruby">endpoint = Async::IO::Endpoint.tcp(hostname, &quot;8080&quot;)</code></pre><p>Prepare the server, endpoint will be used for <code>bind</code>:</p>
<pre><code class="language-ruby">server_endpoint = Async::IO::SSLEndpoint.new(endpoint, ssl_context: authority.server_context)
server = Async::HTTP::Server.new(app, server_endpoint, protocol: Async::HTTP::Protocol::HTTP1, scheme: &quot;https&quot;)</code></pre><p>Prepare the client, endpoint will be used for <code>connect</code>:</p>
<pre><code class="language-ruby">client_endpoint = Async::IO::SSLEndpoint.new(endpoint, ssl_context: authority.client_context)
client = Async::HTTP::Client.new(client_endpoint, protocol: Async::HTTP::Protocol::HTTP1, scheme: &quot;https&quot;, authority: authority)</code></pre><p>Run the reactor:</p>
<pre><code class="language-ruby">Async do |task|
	# Start the server task:
	server_task = task.async do
		server.run
	end
	
	# Connect to the server:
	response = client.get(&quot;/&quot;)
	puts &quot;Status: #{response.status}\n#{response.read}&quot;
	
	# Stop the server:
	server_task.stop
end</code></pre>
				
			<footer>Documentation generated by <a href="https://github.com/socketry/utopia-project">Utopia::Project</a>.</footer>
		</main>
	</body>
</html>